<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Há»‡ thá»‘ng cáº£nh bÃ¡o sáº¡t lá»Ÿ</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header>
    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
      <img src="img/logo.png" alt="Logo" class="logo">
      <div>
        <h1 style="font-size: 26px; margin: 0;">âš ï¸ Cáº£nh BÃ¡o Sáº¡t Lá»Ÿ</h1>
        <p style="margin: 0; margin: 10px auto 0 auto;">GiÃ¡m SÃ¡t & Cáº£nh BÃ¡o Sáº¡t Lá»Ÿ</p>
      </div>
    </div>
  </header>

  <div class="status-box">
    <div class="status-title" style="font-size: 24px;">ğŸŒ± Äá»™ áº©m Ä‘áº¥t:</div>
    <div class="status-value" id="doamdat-value">âˆ’ âˆ’ %&nbsp;<span style="color: green;">&nbsp;âˆ’ âˆ’</span></div>
  </div>

  <div class="status-box">
    <div class="status-title" style="font-size: 24px;">ğŸŒ§ï¸ Tráº¡ng thÃ¡i mÆ°a:</div>
    <div class="status-value" style="color: red;"  id="status-rain">âˆ’ âˆ’</div>
  </div>

  <div class="status-box">
    <div class="status-title" style="font-size: 24px;">ğŸŒ Rung cháº¥n:</div>
    <div class="status-value" style="color: red;"  id="status-rung">âˆ’ âˆ’</div>
  </div>

  <!-- Báº£ng 2 cá»™t: ÄÃ¨n vÃ  Loa -->
  <table>
    <tr>
      <td>
        <img id="imgDen" src="img/denoff.png" alt="ÄÃ¨n cáº£nh bÃ¡o"><br>
        <span class="upda">ÄÃ¨n: <span id="status-den"> âˆ’ âˆ’</span></span>
      </td>
      <td>
        <img id="imgLoa" src="img/loabg.png" alt="Loa cáº£nh bÃ¡o"><br>
        <span class="upda">Loa: <span id="status-loa"> âˆ’ âˆ’</span></span>
      </td>
    </tr>
  </table>
  <footer>
    <p>Â© 2025 Landslide Warning System - DKKN</p>
  </footer>

  <!-- Cá»­a sá»• cáº£nh bÃ¡o sáº¡t lá»Ÿ -->
  <div id="popup-alert" style="display:none;" class="popup-overlay">
    <div class="popup-content">
      <h2>âš ï¸ Cáº£nh bÃ¡o: PhÃ¡t hiá»‡n nguy cÆ¡ sáº¡t lá»Ÿ!</h2>
      <p>Vui lÃ²ng kiá»ƒm tra khu vá»±c Ä‘Æ°á»£c giÃ¡m sÃ¡t ngay láº­p tá»©c Ä‘á»ƒ Ä‘áº£m báº£o an toÃ n.</p>
      <button onclick="closePopup()">ÄÃ£ hiá»ƒu</button>
    </div>
  </div>

  <!-- Káº¿t ná»‘i Firebase -->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-database.js"></script>
  <!-- TODO: Add SDKs for Firebase products that you want to use
       https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-analytics.js"></script>
  
  <script>
    // Firebase cáº¥u hÃ¬nh
    const firebaseConfig = {
      apiKey: "AIzaSyBRWy70tujjr_Nui31B8uqStwqH0qCst4M",
      authDomain: "nhietdo3-18900.firebaseapp.com",
      databaseURL: "https://nhietdo3-18900-default-rtdb.firebaseio.com",
      projectId: "nhietdo3-18900",
      storageBucket: "nhietdo3-18900.firebasestorage.app",
      messagingSenderId: "180648951617",
      appId: "1:180648951617:web:d3658cf4befc6c40b56bc0",
      measurementId: "G-YEL0S96R9T"
    };
    // Khá»Ÿi táº¡o Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();

        // Láº¥y pháº§n tá»­ DOM
    var doamdat = document.getElementById('doamdat-value');
    var muasta = document.getElementById('status-rain');
    var rungsta = document.getElementById('status-rung');
    var densta = document.getElementById('status-den');
    var loasta = document.getElementById('status-loa');
    var canhbao = document.getElementById('status-canhbao');
    
    // Äá»c dá»¯ liá»‡u tá»« Firebase  
    var dbRef = firebase.database().ref("sensor_data/do_am_dat");

    // Ghi nháº­n tráº¡ng thÃ¡i cÃ¡c thiáº¿t bá»‹ tá»« Firebase vÃ  cáº­p nháº­t giao diá»‡n

    //  Äá»˜ áº¨M Äáº¤T   ========================= 
      dbRef.on('value', snap => {
      const value = snap.val();
      let danhGia = "";

      if (value < 30) {
        danhGia = "Äáº¥t khÃ´";
      } else if (value <= 70) {
        danhGia = "Äáº¥t Æ°á»›t";
      } else {
        danhGia = "Äáº¥t quÃ¡ Æ°á»›t";
      }

      doamdat.innerText = value + " % - " + danhGia;
    });

    //  RUNG   =========================
    firebase.database().ref("sensor_data/rung").on('value', snapshot => {
      const value = snapshot.val();
      rungsta.innerText = value === 1 ? "CÃ³ rung" : "BÃ¬nh thÆ°á»ng";
    });

    //  MÆ¯A   =========================
    firebase.database().ref("sensor_data/mua").on('value', snapshot => {
      const value = snapshot.val();
      muasta.innerText = value === 1 ? "CÃ³ mÆ°a" : "KhÃ´ng mÆ°a";
    });

    //----- Cáº¬P NHáº¬T TRáº NG THÃI THIáº¾T Bá»Š Tá»ª FIREBASE ------------------------------------
    function updateUIFromFirebase(img, imgOnSrc, imgOffSrc, value, label) {
      if (value === 1) {
        img.src = imgOnSrc;
        label.innerText = "Báº­t";
        label.classList.remove('off');
        label.classList.add('on');
      } else {
        img.src = imgOffSrc;
        label.innerText = "Táº¯t";
        label.classList.remove('on');
        label.classList.add('off');
      }
    }


    // ======== ÄÃˆN ========================
    const imgDen = document.querySelector('img[alt="ÄÃ¨n cáº£nh bÃ¡o"]');
    const txtDen = document.getElementById("status-den");

    firebase.database().ref("thiet_bi/den").on('value', snapshot => {
      const value = snapshot.val();
      updateUIFromFirebase(imgDen, 'img/denon.png', 'img/denoff.png', value, txtDen);
    });

    // ======== LOA ========================
    const imgLoa = document.querySelector('img[alt="Loa cáº£nh bÃ¡o"]');
    const txtLoa = document.getElementById("status-loa");

    firebase.database().ref("thiet_bi/loa").on('value', snapshot => {
      const value = snapshot.val();
      updateUIFromFirebase(imgLoa, 'img/loaon.png', 'img/loaoff.png', value, txtLoa);
    });

    // === Cáº¢NH BÃO Sáº T Lá» ====================
    firebase.database().ref("canh_bao").on('value', snapshot => {
      const value = snapshot.val();
      if (value === 1) {
        showPopup();
      }
    });

    function showPopup() {
      document.getElementById('popup-alert').style.display = 'flex';
    }

    function closePopup() {
      document.getElementById('popup-alert').style.display = 'none';
    }

    </script>
</body>
</html>
